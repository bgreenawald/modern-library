---
import Layout from '../../../layouts/Layout.astro';
import { getCollection } from 'astro:content';
import { fetchTags } from '../../../lib/github';

export async function getStaticPaths() {
  const books = await getCollection('books');
  const tags = await fetchTags();

  return books.map(book => {
    const versions = tags
      .filter(tag => tag.name.startsWith(book.slug))
      .map(tag => tag.name)
      .sort();
    const latestVersion = versions[versions.length - 1];

    return {
      params: { book: book.slug },
      props: { latestVersion },
    };
  });
}

const { latestVersion } = Astro.props;
const { book } = Astro.params;
const redirectUrl = `/books/${book}/${latestVersion}`;
---

<Layout title="Redirecting...">
  <meta http-equiv="refresh" content={`0;url=${redirectUrl}`} />
  <div class="container mx-auto px-6 py-16 md:py-24 text-center">
    <p class="text-lg">Redirecting to the <a href={redirectUrl} class="text-accent-gold hover:text-accent-gold-hover">latest version</a>...</p>
  </div>
</Layout>