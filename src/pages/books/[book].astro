---
import Layout from '../../layouts/Layout.astro';
import BookDetail from '../../components/BookDetail.astro';
import DownloadsTable from '../../components/DownloadsTable.astro';
import VersionsGrid from '../../components/VersionsGrid.astro';
import { generateBookPaths } from '../../lib/paths';

export async function getStaticPaths() {
  return generateBookPaths();
}

const { book, versions, hasVersions, latestVersion, latestRelease } = Astro.props;
---

<Layout title={book.data.title}>
  <main class="container mx-auto px-6 py-16 md:py-24">
    <BookDetail book={book} />

    <!-- Latest Version Downloads -->
    {latestRelease && (
      <DownloadsTable 
        release={latestRelease} 
        version={latestVersion} 
        title="Latest Version Downloads" 
      />
    )}

    <!-- Show Diff Link -->
    {latestRelease && latestRelease.assets.some(asset => asset.name.endsWith('-modernized.md')) && (
      <section class="text-center mb-12">
        <a 
          href={`/books/${book.slug}/${latestVersion}/diff`}
          class="diff-button"
        >
          Show Diff for This Version
        </a>
      </section>
    )}

    {hasVersions ? (
      <VersionsGrid versions={versions} bookSlug={book.slug} />
    ) : (
      <section class="text-center">
        <p class="text-lg">No versions available for this book yet.</p>
      </section>
    )}
  </main>
</Layout>