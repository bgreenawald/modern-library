
---
import { getCollection } from 'astro:content';

export async function getStaticPaths() {
  const books = await getCollection('books');
  const tags = new Set(books.flatMap(book => book.data.tags || []));

  return Array.from(tags).map(tag => ({
    params: { tag },
    props: { 
      books: books.filter(book => book.data.tags?.includes(tag)),
    },
  }));
}

const { tag } = Astro.params;
const { books } = Astro.props;
---

<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width" />
  <title>Books with tag: {tag}</title>
</head>
<body>
  <h1>Books with tag: {tag}</h1>
  <ul>
    {books.map(book => (
      <li>
        <a href={`/books/${book.slug}`}>{book.data.title}</a>
      </li>
    ))}
  </ul>
</body>
</html>
